#!/bin/bash

# Clone the repository
sudo git clone https://github.com/unnati1810/web-chat-app.git
cd web-chat-app/client

# Install dependencies
sudo npm install

# Build and export Next.js application
sudo npm run build
sudo npm run export

# Create the directory for deployment
sudo mkdir -p /usr/share/nginx/html/my-react-app

# Copy build output to the Nginx directory
sudo cp -R out/* /usr/share/nginx/html/my-react-app/

# Create Nginx configuration file
sudo tee /etc/nginx/conf.d/react.conf <<EOF
server {
  listen 80;
  listen [::]:80;

  root /usr/share/nginx/html/my-react-app; # Ensure this points to the correct directory
  index index.html;

  location / {
    try_files \$uri \$uri/ /index.html;
  }

  # Error and access logs
  error_log /var/log/nginx/error.log;
  access_log /var/log/nginx/access.log;
}
EOF

# Test the Nginx configuration
sudo nginx -t

# Start and enable Nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# Reload and restart Nginx to apply changes
sudo systemctl reload nginx





























































          Fn::Base64: !Sub |
            #!/bin/bash
            sudo dnf update -y
            sudo dnf install -y git
            sudo dnf install -y nodejs npm
            sudo npm install -g npm@latest
            sudo dnf install -y nginx
            sudo mkdir -p /usr/share/nginx/html/my-react-app
            echo 'server {
              listen 80;
              listen [::]:80;
              root /usr/share/nginx/html/my-react-app/build;

              location / {
              try_files $uri /index.html;
            }
            }' | sudo tee /etc/nginx/conf.d/react.conf >/dev/null
            cd /home/ec2-user
            mkdir my-app
            cd my-app
            sudo git clone https://github.com/unnati1810/web-chat-app.git
            cd web-chat-app
            cd client
            sudo npm install
            sudo npm run build
            sudo npm run export
            sudo mkdir -p /usr/share/nginx/html/my-react-app
            sudo cp -R out/* /usr/share/nginx/html/my-react-app/
            sudo cp -R .next /usr/share/nginx/html/my-react-app/
            sudo cp -R public /usr/share/nginx/html/my-react-app/
            sudo tee /etc/nginx/conf.d/react.conf <<EOF
              server {
              listen 80;
              listen [::]:80;

              root /usr/share/nginx/html/my-react-app; # Ensure this points to the correct directory
              index index.html;

              location / {
              try_files \$uri \$uri/ /index.html;
            }

            # Error and access logs
              error_log /var/log/nginx/error.log;
              access_log /var/log/nginx/access.log;
            }
            EOF
            sudo nginx -t
            sudo systemctl start nginx
            sudo systemctl enable nginx
            sudo systemctl restart nginx
            sudo systemctl reload nginx
